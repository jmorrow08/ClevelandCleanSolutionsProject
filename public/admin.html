<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Cleveland Clean Solutions</title>
    <link rel="stylesheet" href="css/tailwind.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    
    <!-- Google Maps API -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCm6ln4PSDxYKsrNEFpuYlnjA0B3dJxGLs&callback=initMapAsh"></script>
    
    <!-- Date libraries removed due to compatibility issues -->
    <!-- Cache bust: v2025.07.18.15.30 -->
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* Hide all sections initially */
        .view-section {
            display: none;
        }
        .view-section.active {
            display: block;
        }
        
        /* Mobile-friendly sidebar styles */
        .sidebar {
            transition: width 0.3s ease, transform 0.3s ease;
        }
        
        .sidebar-collapsed {
            width: 64px !important;
        }
        
        .sidebar-text {
            transition: opacity 0.2s ease;
        }
        
        .sidebar-collapsed .sidebar-text {
            opacity: 0;
            pointer-events: none;
        }
        
        .sidebar-collapsed .nav-item {
            justify-content: center;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        /* Mobile overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 50;
            }
            
            .sidebar-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        /* Desktop responsive */
        @media (min-width: 769px) {
            .main-content {
                transition: margin-left 0.3s ease;
            }
            
            .main-content-expanded {
                margin-left: 64px !important;
            }
        }
        
        /* Table responsive */
        @media (max-width: 640px) {
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 600px;
            }
            
            .card {
                margin: 0.5rem;
                padding: 1rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 8px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1001;
        }
        
        /* Photo review section styles */
        .photo-review-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .photo-item {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="min-h-screen bg-background font-sans">
    <!-- Loading State -->
    <div id="admin-loading-message" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
            <p class="text-lg text-muted-foreground">Loading Admin Portal...</p>
        </div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    
    <!-- Main Application -->
    <div id="admin-dashboard-content" class="hidden">
        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar w-64 bg-white shadow-lg border-r border-border fixed h-full flex flex-col">
                <!-- Sidebar Header -->
                <div class="p-6 border-b border-border">
                    <div class="flex items-center justify-between">
                        <div class="sidebar-text">
                            <h1 class="text-xl font-bold text-foreground">Admin Portal</h1>
                            <p class="text-sm text-muted-foreground">Cleveland Clean Solutions</p>
                        </div>
                        <!-- Sidebar Toggle Button -->
                        <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-secondary transition-colors lg:flex hidden" title="Toggle Sidebar">
                            <i data-lucide="panel-left" class="h-5 w-5"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Header (visible only on mobile when sidebar is open) -->
                <div class="p-4 border-b border-border md:hidden flex items-center justify-between">
                    <span class="font-semibold">Menu</span>
                    <button id="sidebar-close-mobile" class="p-2 rounded-lg hover:bg-secondary transition-colors" title="Close Menu">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
                
                <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                    <button onclick="switchView('dashboard')" class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors bg-primary text-primary-foreground" data-view="dashboard" title="Dashboard">
                        <i data-lucide="layout-dashboard" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </button>
                    <button onclick="switchView('clients')" class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors text-muted-foreground hover:bg-secondary" data-view="clients" title="Clients & Locations">
                        <i data-lucide="building-2" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Clients & Locations</span>
                    </button>
                    <button onclick="switchView('employees')" class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors text-muted-foreground hover:bg-secondary" data-view="employees" title="Employees">
                        <i data-lucide="users" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Employees</span>
                    </button>
                    <button onclick="switchView('service-history')" class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors text-muted-foreground hover:bg-secondary" data-view="service-history" title="Service History">
                        <i data-lucide="briefcase" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Service History</span>
                    </button>
                    <button onclick="switchView('payroll')" class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors text-muted-foreground hover:bg-secondary" data-view="payroll" title="Payroll">
                        <i data-lucide="receipt" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Payroll</span>
                    </button>
                    
                    <!-- New V2 Features (Coming Soon) -->
                    <div class="pt-4 border-t border-border mt-4 sidebar-text">
                        <p class="px-3 text-xs text-muted-foreground uppercase tracking-wider font-medium mb-2">Coming Soon</p>
                    </div>
                    <button class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left text-muted-foreground opacity-50 cursor-not-allowed" disabled title="Invoicing (Coming Soon)">
                        <i data-lucide="file-text" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Invoicing</span>
                    </button>
                    <button class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left text-muted-foreground opacity-50 cursor-not-allowed" disabled title="Scheduling (Coming Soon)">
                        <i data-lucide="calendar" class="h-5 w-5 flex-shrink-0"></i>
                        <span class="sidebar-text">Scheduling</span>
                    </button>
                </nav>
                
                <div class="p-4 border-t border-border">
                    <button id="logout-button" class="btn-destructive w-full flex items-center justify-center gap-2" title="Logout">
                        <i data-lucide="log-out" class="h-4 w-4 flex-shrink-0"></i>
                        <span class="sidebar-text">Logout</span>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu Button -->
            <div class="md:hidden fixed top-4 left-4 z-30">
                <button id="mobile-menu-toggle" class="p-3 bg-white rounded-lg shadow-lg border border-border hover:bg-secondary transition-colors" title="Open Menu">
                    <i data-lucide="menu" class="h-5 w-5"></i>
                </button>
            </div>
            
            <!-- Main Content -->
            <div id="main-content" class="main-content flex-1 ml-64 min-h-screen bg-background overflow-x-auto">
                <!-- Dashboard View -->
                <div id="view-dashboard" class="view-section active p-6 space-y-6">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-foreground mb-2">Dashboard</h2>
                        <p class="text-muted-foreground">Overview of your cleaning service operations</p>
                    </div>

                    <!-- Quick Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card">
                            <div class="card-header flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="text-sm font-medium">Services Today</h3>
                                <i data-lucide="calendar" class="h-4 w-4 text-muted-foreground"></i>
                            </div>
                            <div class="card-content">
                                <div class="text-2xl font-bold" id="stats-today-count">-</div>
                                <p class="text-xs text-muted-foreground">Scheduled for today</p>
                                <div id="today-services-list" class="mt-2 space-y-1">
                                    <!-- Today's services will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="text-sm font-medium">Services Tomorrow</h3>
                                <i data-lucide="calendar-plus" class="h-4 w-4 text-muted-foreground"></i>
                            </div>
                            <div class="card-content">
                                <div class="text-2xl font-bold" id="stats-tomorrow-count">-</div>
                                <p class="text-xs text-muted-foreground">Scheduled for tomorrow</p>
                                <div id="tomorrow-services-list" class="mt-2 space-y-1">
                                    <!-- Tomorrow's services will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="text-sm font-medium">Active Clients</h3>
                                <i data-lucide="building-2" class="h-4 w-4 text-muted-foreground"></i>
                            </div>
                            <div class="card-content">
                                <div class="text-2xl font-bold" id="stats-active-clients-count">-</div>
                                <p class="text-xs text-muted-foreground">Currently active</p>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="text-sm font-medium">Active Employees</h3>
                                <i data-lucide="users" class="h-4 w-4 text-muted-foreground"></i>
                            </div>
                            <div class="card-content">
                                <div class="text-2xl font-bold" id="stats-active-employees-count">-</div>
                                <p class="text-xs text-muted-foreground">Team members</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-lg">Quick Add Service</h3>
                            </div>
                            <div class="card-content">
                                <form id="quick-add-service-form" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="qas-client-select" class="block text-sm font-medium mb-1">Client</label>
                                            <select id="qas-client-select" class="w-full px-3 py-2 border border-border rounded-md">
                                                <option value="">-- Select Client --</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="qas-location-select" class="block text-sm font-medium mb-1">Location</label>
                                            <select id="qas-location-select" class="w-full px-3 py-2 border border-border rounded-md">
                                                <option value="">-- Select Location --</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="qas-service-date" class="block text-sm font-medium mb-1">Service Date</label>
                                            <input type="date" id="qas-service-date" class="w-full px-3 py-2 border border-border rounded-md">
                                        </div>
                                        <div>
                                            <label for="qas-service-time" class="block text-sm font-medium mb-1">Service Time</label>
                                            <input type="time" id="qas-service-time" class="w-full px-3 py-2 border border-border rounded-md">
                                        </div>
                                    </div>
                                    <div>
                                        <label for="qas-service-type" class="block text-sm font-medium mb-1">Service Notes</label>
                                        <textarea id="qas-service-type" rows="2" placeholder="Service type and notes..." class="w-full px-3 py-2 border border-border rounded-md"></textarea>
                                    </div>
                                    <div id="qas-message" class="text-sm hidden"></div>
                                    <div class="flex gap-2">
                                        <button type="submit" id="quick-add-service-button" class="btn-primary">
                                            <i data-lucide="plus" class="h-4 w-4 mr-2"></i>
                                            Add Service
                                        </button>
                                        <button type="button" id="qas-cancel-button" class="btn-secondary">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-lg">Employee Activity & Clock-in/Out Locations</h3>
                            </div>
                            <div class="card-content">
                                <div id="time-tracking-display">
                                    <p class="text-muted-foreground">Loading time tracking data...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Job Processing Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Job Processing Status</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-3 bg-yellow-50 rounded-lg border">
                                    <div class="text-xl font-bold text-yellow-600" id="pending-jobs-count">-</div>
                                    <div class="text-xs text-yellow-600">Pending Jobs</div>
                                </div>
                                <div class="text-center p-3 bg-blue-50 rounded-lg border">
                                    <div class="text-xl font-bold text-blue-600" id="in-progress-jobs-count">-</div>
                                    <div class="text-xs text-blue-600">In Progress</div>
                                </div>
                                <div class="text-center p-3 bg-green-50 rounded-lg border">
                                    <div class="text-xl font-bold text-green-600" id="completed-jobs-count">-</div>
                                    <div class="text-xs text-green-600">Completed</div>
                                </div>
                                <div class="text-center p-3 bg-purple-50 rounded-lg border">
                                    <div class="text-xl font-bold text-purple-600" id="scheduled-jobs-count">-</div>
                                    <div class="text-xs text-purple-600">Scheduled</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h3 class="card-title">Payroll Status</h3>
                                <button id="dashboard-process-payroll-button" class="btn-primary text-xs px-3 py-1">
                                    <i data-lucide="dollar-sign" class="h-3 w-3 mr-1"></i>
                                    Process Payroll
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-3 bg-amber-50 rounded-lg border">
                                    <div class="text-xl font-bold text-amber-600" id="pending-payroll-amount">$0.00</div>
                                    <div class="text-xs text-amber-600">Pending Payroll</div>
                                </div>
                                <div class="text-center p-3 bg-green-50 rounded-lg border">
                                    <div class="text-xl font-bold text-green-600" id="processed-payroll-count">0</div>
                                    <div class="text-xs text-green-600">Processed Records</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="text-xs text-muted-foreground" id="payroll-status-message">Loading payroll status...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Services</h3>
                        </div>
                        <div class="card-content">
                            <div id="recent-services-list" class="space-y-2">
                                <div class="text-muted-foreground text-sm">Loading recent services...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clients View -->
                <div id="view-clients" class="view-section p-6 space-y-6">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-foreground mb-2">Client & Location Management</h2>
                        <p class="text-muted-foreground">Manage your client accounts and service locations</p>
                    </div>
                    
                    <!-- Client List Section -->
                    <div id="client-list-section" class="card">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h3 class="card-title">Client List</h3>
                                <button id="show-add-client-form-button-page" class="btn-primary">
                                    <i data-lucide="plus" class="h-4 w-4 mr-2"></i>
                                    Add New Client
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <p id="client-loading-message" class="text-muted-foreground">Loading clients...</p>
                            <div id="client-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
                                <!-- Client cards will be dynamically generated here -->
                            </div>
                            <div id="no-clients-message" class="hidden text-center py-8 text-muted-foreground">
                                No clients found.
                            </div>
                        </div>
                    </div>

                    <!-- Add Client Form -->
                    <div id="add-client-form-section" class="card hidden">
                        <div class="card-header">
                            <h3 class="card-title">Add New Client</h3>
                        </div>
                        <div class="card-content">
                            <form id="add-client-form" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <label for="client-company-name" class="text-sm font-medium">Company Name:</label>
                                        <input type="text" id="client-company-name" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="client-contact-name" class="text-sm font-medium">Contact Name:</label>
                                        <input type="text" id="client-contact-name" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="client-id-string" class="text-sm font-medium">Client ID String:</label>
                                        <input type="text" id="client-id-string" placeholder="e.g., CCS-1001" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                        <small class="text-xs text-muted-foreground">Enter unique ID.</small>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="client-email" class="text-sm font-medium">Email:</label>
                                        <input type="email" id="client-email" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="client-phone" class="text-sm font-medium">Phone:</label>
                                        <input type="tel" id="client-phone" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="client-initial-password" class="text-sm font-medium">Initial Password:</label>
                                        <input type="password" id="client-initial-password" required minlength="6" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                </div>
                                <div class="flex gap-2 pt-4">
                                    <button type="submit" class="btn-primary">Create Client</button>
                                    <button type="button" class="btn-secondary" id="cancel-add-client-form">Cancel</button>
                                </div>
                                <div id="add-client-message" class="mt-4 text-sm"></div>
                            </form>
                        </div>
                    </div>

                    <!-- Edit Client Form -->
                    <div id="edit-client-form-section" class="card hidden">
                        <div class="card-header">
                            <h3 class="card-title">Edit Client Profile</h3>
                        </div>
                        <div class="card-content">
                            <form id="edit-client-form" class="space-y-4">
                                <input type="hidden" id="edit-client-uid">
                                <input type="hidden" id="edit-client-auth-uid">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <label for="edit-client-company-name" class="text-sm font-medium">Company Name:</label>
                                        <input type="text" id="edit-client-company-name" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-client-contact-name" class="text-sm font-medium">Contact Name:</label>
                                        <input type="text" id="edit-client-contact-name" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-client-email" class="text-sm font-medium">Email:</label>
                                        <input type="email" id="edit-client-email" required readonly class="w-full px-3 py-2 border border-border rounded-md bg-muted">
                                        <small class="text-xs text-muted-foreground">(Email/Login cannot be changed)</small>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-client-phone" class="text-sm font-medium">Phone:</label>
                                        <input type="tel" id="edit-client-phone" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-client-id-string" class="text-sm font-medium">Client ID String:</label>
                                        <input type="text" id="edit-client-id-string" readonly class="w-full px-3 py-2 border border-border rounded-md bg-muted">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-client-status" class="text-sm font-medium">Status:</label>
                                        <select id="edit-client-status" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                            <option value="true">Active</option>
                                            <option value="false">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex gap-2 pt-4">
                                    <button type="submit" class="btn-primary">Save Client Changes</button>
                                    <button type="button" class="btn-secondary" id="cancel-edit-client-form">Cancel</button>
                                </div>
                                <div id="edit-client-message" class="mt-4 text-sm"></div>
                                
                                <!-- Password Reset Section -->
                                <div class="border-t border-border pt-4 mt-6">
                                    <h4 class="text-lg font-medium mb-4">Set New Password for Client</h4>
                                    <div class="flex gap-2 items-end">
                                        <div class="flex-grow space-y-2">
                                            <label for="set-client-new-password-input" class="text-sm font-medium">New Password:</label>
                                            <input type="password" id="set-client-new-password-input" minlength="6" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                        </div>
                                        <button type="button" class="btn-secondary h-10 px-3" data-target="set-client-new-password-input" title="Show/Hide password">
                                            <i data-lucide="eye" class="h-4 w-4"></i>
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <button type="button" id="set-client-new-password-button" class="btn-destructive">Set Client Password</button>
                                        <small class="block mt-2 text-xs text-muted-foreground">This will immediately change the client's login password. Use with caution.</small>
                                    </div>
                                    <div id="set-client-password-message" class="mt-4 text-sm"></div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Locations Management Section -->
                    <div id="locations-management-section" class="card">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h3 class="card-title">Manage All Locations</h3>
                                <button id="show-add-location-form-button-page" class="btn-primary">
                                    <i data-lucide="map-pin" class="h-4 w-4 mr-2"></i>
                                    Add New Location
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <p id="locations-loading-message" class="text-muted-foreground">Loading locations...</p>
                            <div class="overflow-x-auto">
                                <table id="locations-table" class="w-full hidden">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left p-4 font-medium text-muted-foreground">Location ID</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Location Name</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Client Name</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Address</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Status</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Photos</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="locations-table-body" class="divide-y"></tbody>
                                </table>
                            </div>
                            <p id="no-locations-message" class="text-muted-foreground hidden">No locations found.</p>
                        </div>
                    </div>

                    <!-- Add/Edit Location Form -->
                    <div id="add-edit-location-form-section" class="card hidden">
                        <div class="card-header">
                            <h3 id="location-form-title" class="card-title">Add New Location</h3>
                        </div>
                        <div class="card-content">
                            <form id="add-edit-location-form" class="space-y-4">
                                <input type="hidden" id="edit-location-doc-id">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div class="space-y-2">
                                        <label for="location-client-select" class="text-sm font-medium">Assign to Client:</label>
                                        <select id="location-client-select" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                            <option value="">-- Loading Clients --</option>
                                        </select>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-name" class="text-sm font-medium">Location Name:</label>
                                        <input type="text" id="location-name" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-id-string" class="text-sm font-medium">Location ID String:</label>
                                        <input type="text" id="location-id-string" placeholder="e.g., LOC-1001" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                        <small class="text-xs text-muted-foreground">Enter unique ID for this location.</small>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-address-street" class="text-sm font-medium">Street:</label>
                                        <input type="text" id="location-address-street" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-address-city" class="text-sm font-medium">City:</label>
                                        <input type="text" id="location-address-city" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-address-state" class="text-sm font-medium">State:</label>
                                        <input type="text" id="location-address-state" value="OH" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-address-zip" class="text-sm font-medium">Zip Code:</label>
                                        <input type="text" id="location-address-zip" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-contact-name" class="text-sm font-medium">Location Contact Name:</label>
                                        <input type="text" id="location-contact-name" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-contact-phone" class="text-sm font-medium">Location Contact Phone:</label>
                                        <input type="tel" id="location-contact-phone" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-service-frequency" class="text-sm font-medium">Service Frequency:</label>
                                        <select id="location-service-frequency" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                            <option value="">-- Select Frequency --</option>
                                            <option value="One-Time">One-Time</option>
                                            <option value="Weekly">Weekly</option>
                                            <option value="CustomWeekly">Custom Days Weekly</option>
                                            <option value="Bi-Weekly">Bi-Weekly</option>
                                            <option value="Monthly">Monthly</option>
                                        </select>
                                        <small class="text-xs text-muted-foreground">Select frequency. Choose 'Custom Days Weekly' to select specific days below.</small>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-next-service-date" class="text-sm font-medium">Next Scheduled Service Date:</label>
                                        <input type="date" id="location-next-service-date" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="edit-location-nextServiceTime" class="text-sm font-medium">Next Service Time (Optional):</label>
                                        <input type="time" id="edit-location-nextServiceTime" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="location-last-service-date" class="text-sm font-medium">Last Service Date:</label>
                                        <input type="date" id="location-last-service-date" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                </div>

                                <!-- Service Days Selection -->
                                <div id="location-service-days-group" class="hidden p-4 bg-secondary rounded-md">
                                    <label class="text-sm font-medium mb-3 block">Select Service Days (for Custom Weekly):</label>
                                    <div class="flex flex-wrap gap-4">
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="0" class="mr-2"> Sun
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="1" class="mr-2"> Mon
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="2" class="mr-2"> Tue
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="3" class="mr-2"> Wed
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="4" class="mr-2"> Thu
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="5" class="mr-2"> Fri
                                        </label>
                                        <label class="flex items-center font-normal">
                                            <input type="checkbox" name="serviceDay" value="6" class="mr-2"> Sat
                                        </label>
                                    </div>
                                </div>

                                <!-- Location Status -->
                                <div>
                                    <label for="location-status" class="text-sm font-medium">Status:</label>
                                    <select id="location-status" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>

                                <div class="flex gap-2 pt-4">
                                    <button type="submit" id="save-location-button" class="btn-primary">Save Location</button>
                                    <button type="button" class="btn-secondary" id="cancel-add-edit-location-form">Cancel</button>
                                </div>
                                <div id="add-edit-location-message" class="mt-4 text-sm"></div>
                            </form>
                        </div>
                    </div>

                    <!-- Location Photos Section -->
                    <div id="location-photos-section" class="card hidden">
                        <div class="card-header">
                            <h3 id="location-photos-title" class="card-title">Photos for Location</h3>
                            <p class="text-sm text-muted-foreground">Sorted newest first</p>
                        </div>
                        <div class="card-content">
                            <div class="photo-review-container">
                                <div id="location-photos-container" class="photo-grid">
                                    <p id="photos-loading-message" class="text-muted-foreground hidden">Loading photos...</p>
                                </div>
                                <p id="no-location-photos-message" class="text-muted-foreground hidden">No photos found for this location.</p>
                            </div>
                            <div class="mt-6">
                                <button type="button" class="btn-secondary" id="back-to-locations-from-photos">
                                    <i data-lucide="arrow-left" class="h-4 w-4 mr-2"></i>
                                    Back to Locations List
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Employees View -->
                <div id="view-employees" class="view-section p-6 space-y-6">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-foreground mb-2">Employee Management</h2>
                        <p class="text-muted-foreground">Manage your team and employee settings</p>
                    </div>
                    
                    <!-- Employee List -->
                    <div class="card">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h3 class="card-title">Employee List</h3>
                                <button id="show-add-employee-form-button" class="btn-primary">
                                    <i data-lucide="user-plus" class="h-4 w-4 mr-2"></i>
                                    Add New Employee
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <p id="employee-loading-message" class="text-muted-foreground">Loading employees...</p>
                            <div id="employee-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
                                <!-- Employee cards will be dynamically generated here -->
                            </div>
                            <div id="no-employees-message" class="hidden text-center py-8 text-muted-foreground">
                                No employees found.
                            </div>
                        </div>
                    </div>

                    <!-- Add Employee Form (hidden by default) -->
                    <div id="add-employee-form-section" class="card hidden">
                        <div class="card-header">
                            <h3 class="card-title">Add New Employee</h3>
                        </div>
                        <div class="card-content">
                            <form id="add-employee-form" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="add-employee-name" class="block text-sm font-medium mb-1">Full Name</label>
                                        <input type="text" id="add-employee-name" required class="w-full px-3 py-2 border border-border rounded-md">
                                    </div>
                                    <div>
                                        <label for="add-employee-email" class="block text-sm font-medium mb-1">Email</label>
                                        <input type="email" id="add-employee-email" required class="w-full px-3 py-2 border border-border rounded-md">
                                    </div>
                                    <div>
                                        <label for="add-employee-phone" class="block text-sm font-medium mb-1">Phone</label>
                                        <input type="tel" id="add-employee-phone" class="w-full px-3 py-2 border border-border rounded-md">
                                    </div>
                                    <div>
                                        <label for="add-employee-role" class="block text-sm font-medium mb-1">Role</label>
                                        <select id="add-employee-role" class="w-full px-3 py-2 border border-border rounded-md">
                                            <option value="cleaner">Cleaner</option>
                                            <option value="supervisor">Supervisor</option>
                                            <option value="manager">Manager</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button type="submit" class="btn-primary">Save Employee</button>
                                    <button type="button" id="cancel-add-employee" class="btn-secondary">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Edit Employee Form (hidden by default) -->
                    <div id="edit-employee-form-section" class="card hidden">
                        <div class="card-header">
                            <h3 class="card-title">Edit Employee</h3>
                        </div>
                        <div class="card-content">
                                                         <form id="edit-employee-form" class="space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                     <div>
                                         <label for="edit-employee-first-name" class="block text-sm font-medium mb-1">First Name</label>
                                         <input type="text" id="edit-employee-first-name" required class="w-full px-3 py-2 border border-border rounded-md">
                                     </div>
                                     <div>
                                         <label for="edit-employee-last-name" class="block text-sm font-medium mb-1">Last Name</label>
                                         <input type="text" id="edit-employee-last-name" required class="w-full px-3 py-2 border border-border rounded-md">
                                     </div>
                                     <div>
                                         <label for="edit-employee-email" class="block text-sm font-medium mb-1">Email</label>
                                         <input type="email" id="edit-employee-email" required class="w-full px-3 py-2 border border-border rounded-md">
                                     </div>
                                     <div>
                                         <label for="edit-employee-phone" class="block text-sm font-medium mb-1">Phone</label>
                                         <input type="tel" id="edit-employee-phone" class="w-full px-3 py-2 border border-border rounded-md">
                                     </div>
                                     <div>
                                         <label for="edit-employee-job-title" class="block text-sm font-medium mb-1">Job Title</label>
                                         <input type="text" id="edit-employee-job-title" class="w-full px-3 py-2 border border-border rounded-md">
                                     </div>
                                     <div>
                                         <label for="edit-employee-id-string" class="block text-sm font-medium mb-1">Employee ID</label>
                                         <input type="text" id="edit-employee-id-string" readonly class="w-full px-3 py-2 border border-border rounded-md bg-gray-50">
                                     </div>
                                     <div>
                                         <label for="edit-employee-system-id" class="block text-sm font-medium mb-1">System ID</label>
                                         <input type="text" id="edit-employee-system-id" readonly class="w-full px-3 py-2 border border-border rounded-md bg-gray-50">
                                     </div>
                                     <div>
                                         <label for="edit-employee-auth-uid" class="block text-sm font-medium mb-1">Auth UID</label>
                                         <input type="text" id="edit-employee-auth-uid" readonly class="w-full px-3 py-2 border border-border rounded-md bg-gray-50">
                                     </div>
                                     <div>
                                         <label for="edit-employee-status" class="block text-sm font-medium mb-1">Status</label>
                                         <select id="edit-employee-status" class="w-full px-3 py-2 border border-border rounded-md">
                                             <option value="true">Active</option>
                                             <option value="false">Inactive</option>
                                         </select>
                                     </div>
                                     <div>
                                         <label for="edit-employee-role" class="block text-sm font-medium mb-1">Employee Role</label>
                                         <select id="edit-employee-role" class="w-full px-3 py-2 border border-border rounded-md">
                                             <option value="employee">Employee</option>
                                             <option value="admin">Admin</option>
                                             <option value="manager">Manager</option>
                                         </select>
                                         <small class="text-xs text-muted-foreground">Changes employee's system access level</small>
                                     </div>
                                 </div>
                                                                 <div class="flex gap-2">
                                     <button type="submit" class="btn-primary">Update Employee</button>
                                     <button type="button" id="cancel-edit-employee" class="btn-secondary">Cancel</button>
                                 </div>
                             </form>
                         </div>
                     </div>

                    <!-- Employee Password Management -->
                    <div id="employee-password-section" class="card hidden">
                        <div class="card-header">
                            <h3 class="card-title">Password Management</h3>
                        </div>
                        <div class="card-content">
                            <div class="space-y-4">
                                <div>
                                    <label for="employee-new-password" class="block text-sm font-medium mb-1">New Password</label>
                                    <input type="password" id="employee-new-password" minlength="6" class="w-full px-3 py-2 border border-border rounded-md">
                                </div>
                                <div class="flex gap-2">
                                    <button type="button" id="set-employee-new-password-button" class="btn-primary">Set Password</button>
                                    <button type="button" id="cancel-employee-password" class="btn-secondary">Cancel</button>
                                </div>
                                <div id="employee-password-message" class="text-sm mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- User Role Management -->
                    <div id="user-role-management-section" class="card">
                        <div class="card-header">
                            <h3 class="card-title">Role Management</h3>
                        </div>
                        <div class="card-content">
                            <div class="space-y-4">
                                <input type="hidden" id="role-mgmt-target-uid">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Current Roles</label>
                                    <div id="current-roles-display" class="p-3 bg-gray-50 rounded border text-sm">
                                        Loading roles...
                                    </div>
                                </div>
                                <div>
                                    <label for="role-select" class="block text-sm font-medium mb-1">Add Role</label>
                                    <select id="role-select" class="w-full px-3 py-2 border border-border rounded-md">
                                        <option value="">Select Role</option>
                                        <option value="admin">Admin</option>
                                        <option value="manager">Manager</option>
                                        <option value="employee">Employee</option>
                                    </select>
                                </div>
                                <div class="flex gap-2">
                                    <button type="button" id="add-role-button" class="btn-primary">Add Role</button>
                                    <button type="button" id="remove-role-button" class="btn-destructive">Remove Role</button>
                                </div>
                                <div id="role-management-message" class="text-sm mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Rates Section -->
                    <div id="employee-rate-management-section" class="card">
                        <div class="card-header">
                            <h3 class="card-title">Employee Rate Management</h3>
                            <p class="text-sm text-muted-foreground">Current Employee: <span id="current-employee-name-for-rates">None selected</span></p>
                        </div>
                        <div class="card-content">
                            <!-- Rate Display Table -->
                            <div class="mb-6">
                                <h4 class="text-lg font-medium mb-3">Current Rates</h4>
                                <div class="overflow-x-auto">
                                    <table id="employee-rates-table" class="w-full border-collapse">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="text-left p-3 font-medium">Client</th>
                                                <th class="text-left p-3 font-medium">Rate</th>
                                                <th class="text-left p-3 font-medium">Effective Date</th>
                                                <th class="text-left p-3 font-medium">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="employee-rates-table-body">
                                            <tr>
                                                <td colspan="4" class="p-4 text-center text-muted-foreground">No rates set for this employee</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Add New Rate Form -->
                            <div class="border-t pt-6">
                                <h4 class="text-lg font-medium mb-3">Add New Rate</h4>
                                <form id="add-employee-rate-form" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label for="rate-client-select" class="block text-sm font-medium mb-1">Client</label>
                                            <select id="rate-client-select" required class="w-full px-3 py-2 border border-border rounded-md">
                                                <option value="">Select Client</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="rate-amount" class="block text-sm font-medium mb-1">Rate ($/hour)</label>
                                            <input type="number" id="rate-amount" step="0.01" min="0" required class="w-full px-3 py-2 border border-border rounded-md">
                                        </div>
                                        <div>
                                            <label for="rate-effective-date" class="block text-sm font-medium mb-1">Effective Date</label>
                                            <input type="date" id="rate-effective-date" required class="w-full px-3 py-2 border border-border rounded-md">
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button type="submit" class="btn-primary">Add Rate</button>
                                        <button type="button" id="cancel-rate-form" class="btn-secondary">Cancel</button>
                                    </div>
                                </form>
                            </div>
                            <div id="rate-management-status" class="mt-4 text-sm"></div>
                        </div>
                    </div>
                </div>

                <!-- Service History View -->
                <div id="view-service-history" class="view-section p-6 space-y-6">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-foreground mb-2">Service History</h2>
                        <p class="text-muted-foreground">View and manage service records and history</p>
                    </div>

                    <!-- Add Service Record Button -->
                    <div class="flex justify-between items-center">
                        <button id="show-add-service-history-form-button" class="btn-primary">
                            <i data-lucide="plus" class="h-4 w-4 mr-2"></i>
                            Add New Service Record
                        </button>
                    </div>

                    <!-- Add/Edit Service History Form -->
                    <div id="add-edit-service-history-section" class="card hidden">
                        <div class="card-header">
                            <h3 id="service-history-form-title" class="card-title">Add New Service Record</h3>
                        </div>
                        <div class="card-content">
                            <form id="add-edit-service-history-form" class="space-y-4">
                                <input type="hidden" id="edit-service-history-doc-id">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div class="space-y-2">
                                        <label for="sh-client-select" class="text-sm font-medium">Client:</label>
                                        <select id="sh-client-select" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                            <option value="">-- Loading Clients --</option>
                                        </select>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="sh-location-select" class="text-sm font-medium">Location:</label>
                                        <select id="sh-location-select" required disabled class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring bg-muted">
                                            <option value="">-- Select Client First --</option>
                                        </select>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="sh-service-date" class="text-sm font-medium">Service Date:</label>
                                        <input type="date" id="sh-service-date" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="sh-service-type" class="text-sm font-medium">Service Type:</label>
                                        <input type="text" id="sh-service-type" placeholder="e.g., Weekly Cleaning" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="sh-status" class="text-sm font-medium">Status:</label>
                                        <select id="sh-status" required class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                            <option value="Scheduled">Scheduled</option>
                                            <option value="Completed">Completed</option>
                                            <option value="Missed">Missed</option>
                                            <option value="Cancelled">Cancelled</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Employees Section -->
                                <div class="space-y-2">
                                    <label class="text-sm font-medium">Employees Assigned:</label>
                                    <div id="sh-employee-checkbox-list" class="max-h-40 overflow-y-auto border border-border rounded-md p-4 bg-card">
                                        <p class="text-muted-foreground">Loading employees...</p>
                                    </div>
                                    <small class="text-xs text-muted-foreground">Check all employees who performed this service.</small>
                                </div>

                                <!-- Service Notes -->
                                <div class="space-y-2">
                                    <label for="sh-service-notes" class="text-sm font-medium">Original Service Notes (Employee/Initial):</label>
                                    <textarea id="sh-service-notes" rows="3" placeholder="Notes from employee or initial service details..." class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring"></textarea>
                                </div>

                                <!-- Admin Notes -->
                                <div class="space-y-2">
                                    <label for="sh-admin-notes" class="text-sm font-medium">Admin Notes (May be visible to client):</label>
                                    <textarea id="sh-admin-notes" rows="4" placeholder="Add any notes for the client or internal remarks for review..." class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring"></textarea>
                                </div>

                                <!-- Photo Review Section -->
                                <div id="sh-photo-review-section" class="space-y-4 border-t border-border pt-4">
                                    <h4 class="text-lg font-medium">Review Service Photos for Client Portal</h4>
                                    <div class="flex gap-2 mb-4">
                                        <button type="button" id="sh-approve-all-photos-btn" class="btn-primary">
                                            <i data-lucide="check-circle" class="h-4 w-4 mr-2"></i>
                                            Approve All
                                        </button>
                                        <button type="button" id="sh-hide-all-photos-btn" class="btn-secondary">
                                            <i data-lucide="eye-off" class="h-4 w-4 mr-2"></i>
                                            Hide All
                                        </button>
                                    </div>
                                    <p class="text-sm text-muted-foreground">Check photos you want to be visible to the client. Unchecked photos will not be shown on the client portal.</p>
                                    
                                    <div id="sh-photo-review-gallery-loading" class="hidden text-center py-4">
                                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"></div>
                                        <p class="text-muted-foreground">Loading photos for review...</p>
                                    </div>
                                    <div id="sh-photo-review-gallery" class="photo-review-container">
                                        <div class="photo-grid">
                                            <p id="sh-no-photos-for-review" class="text-center text-muted-foreground">No photos uploaded for this service or photos are still loading.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Time Tracking Section -->
                                <div id="sh-time-tracking-display-section" class="space-y-4 border-t border-border pt-4">
                                    <h4 class="text-lg font-medium">Employee Activity & Clock-in/Out Locations</h4>
                                    <div id="sh-time-tracking-loading" class="hidden text-center py-4">
                                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"></div>
                                        <p class="text-muted-foreground">Loading time tracking data...</p>
                                    </div>
                                    <div id="sh-time-tracking-list" class="max-h-96 overflow-y-auto border border-border rounded-md p-4 bg-card">
                                        <p id="sh-no-time-tracking" class="text-muted-foreground hidden">No clock-in/out data found for this service's location and date.</p>
                                    </div>
                                </div>

                                <div class="flex gap-2 pt-4 border-t border-border">
                                    <button type="submit" id="save-service-history-button" class="btn-primary">Save / Update Record</button>
                                    <button type="button" id="cancel-add-edit-service-history-button" class="btn-secondary">Cancel</button>
                                </div>
                                <div id="add-edit-service-history-message" class="mt-4 text-sm"></div>
                            </form>
                        </div>
                    </div>

                    <!-- Service History List View -->
                    <div id="service-history-list-view" class="space-y-6">
                        <!-- Filters Section -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Filter Service History</h3>
                            </div>
                            <div class="card-content">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                                    <div class="space-y-2">
                                        <label for="filter-date-start" class="text-sm font-medium">Start Date (Optional):</label>
                                        <input type="date" id="filter-date-start" placeholder="No start date limit" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <div class="space-y-2">
                                        <label for="filter-date-end" class="text-sm font-medium">End Date (Optional):</label>
                                        <input type="date" id="filter-date-end" placeholder="No end date limit" class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                                    </div>
                                    <button type="button" id="apply-filters-button" class="btn-primary">Apply Filters</button>
                                    <button type="button" id="reset-filters-button" class="btn-secondary">Show All Records</button>
                                </div>
                                <p class="text-sm text-muted-foreground mt-4">
                                    <strong>Tip:</strong> Leave both dates blank to view the complete service history, or set a date range to filter records.
                                </p>
                            </div>
                        </div>

                        <!-- Table Controls -->
                        <div class="card">
                            <div class="card-content">
                                <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                                    <div class="flex items-center gap-2">
                                        <label for="records-per-page" class="text-sm font-medium">Records per page:</label>
                                        <select id="records-per-page" class="px-3 py-1 border border-border rounded-md">
                                            <option value="25">25</option>
                                            <option value="50" selected>50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </div>
                                    <div id="table-info" class="text-sm text-muted-foreground">
                                        <!-- Shows current range and total -->
                                    </div>
                                </div>

                                <div id="service-history-loading-message" class="hidden text-center py-8">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                                    <p class="text-muted-foreground">Loading service history... Please wait.</p>
                                </div>

                                <div id="no-service-history-message" class="hidden text-center py-8 text-muted-foreground">
                                    No service history records found for the selected criteria.
                                </div>

                                <!-- Service History Table -->
                                <div class="overflow-x-auto border border-border rounded-lg">
                                    <table id="service-history-table" class="w-full min-w-full">
                                        <thead class="bg-muted">
                                            <tr>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[100px]">Service Date</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[150px]">Location</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[120px]">Client</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[150px]">Assigned Employees</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[120px]">Service Type</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[80px]">Status</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[150px]">Notes</th>
                                                <th class="text-left p-4 font-medium text-muted-foreground min-w-[180px]">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="service-history-table-body" class="divide-y divide-border bg-card">
                                            <!-- Table rows will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination Controls -->
                                <div class="flex justify-center items-center gap-2 mt-6 flex-wrap">
                                    <button id="first-page-btn" class="btn-secondary">First</button>
                                    <button id="prev-page-btn" class="btn-secondary">Previous</button>
                                    <span id="page-info" class="px-4 font-medium">Page 1 of 1</span>
                                    <button id="next-page-btn" class="btn-secondary">Next</button>
                                    <button id="last-page-btn" class="btn-secondary">Last</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Photos Viewer Modal -->
                    <div id="service-photos-viewer-section" class="modal-overlay">
                        <div class="modal-content p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 id="photos-viewer-title" class="text-xl font-bold">Service Photos</h3>
                                <button id="close-photos-viewer-button" class="text-muted-foreground hover:text-foreground text-2xl font-bold leading-none">
                                    <i data-lucide="x" class="h-6 w-6"></i>
                                </button>
                            </div>
                            
                            <div id="photos-viewer-loading-message" class="hidden text-center py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
                                <p class="text-muted-foreground">Loading photos...</p>
                            </div>
                            
                            <div id="no-service-photos-message" class="hidden text-center py-8 text-muted-foreground">
                                No photos found for this service entry.
                            </div>
                            
                            <div id="photos-viewer-container" class="photo-review-container">
                                <div class="photo-grid">
                                    <!-- Photos will be dynamically loaded here by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payroll View -->
                <div id="view-payroll" class="view-section p-6 space-y-6">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-foreground mb-2">Payroll Management</h2>
                        <p class="text-muted-foreground">View and manage employee payroll</p>
                    </div>
                    
                    <!-- Payroll Summary -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Payroll Summary</h3>
                        </div>
                        <div class="card-content">
                            <p id="payroll-loading-message" class="text-muted-foreground">Loading payroll data...</p>
                            <div id="payroll-summary-content" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <div class="text-center p-4 bg-secondary rounded-lg">
                                        <div class="text-2xl font-bold" id="total-pending-amount">$0.00</div>
                                        <div class="text-sm text-muted-foreground">Pending Payroll</div>
                                    </div>
                                    <div class="text-center p-4 bg-secondary rounded-lg">
                                        <div class="text-2xl font-bold" id="total-completed-jobs">0</div>
                                        <div class="text-sm text-muted-foreground">Jobs This Period</div>
                                    </div>
                                    <div class="text-center p-4 bg-secondary rounded-lg">
                                        <div class="text-2xl font-bold" id="active-employees-count">0</div>
                                        <div class="text-sm text-muted-foreground">Active Employees</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll Table -->
                    <div class="card">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h3 class="card-title">Employee Payroll</h3>
                                <button id="process-payroll-button" class="btn-primary">
                                    <i data-lucide="calculator" class="h-4 w-4 mr-2"></i>
                                    Process Payroll
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="overflow-x-auto">
                                <table id="payroll-table" class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left p-4 font-medium text-muted-foreground">Employee</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Jobs Completed</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Hours Worked</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Rate</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Total Amount</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Status</th>
                                            <th class="text-left p-4 font-medium text-muted-foreground">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="payroll-table-body" class="divide-y">
                                        <!-- Payroll data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Payroll Adjustment Form -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Payroll Adjustments</h3>
                        </div>
                        <div class="card-content">
                            <form id="add-adjustment-form" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label for="adjustment-employee-select" class="block text-sm font-medium mb-1">Employee</label>
                                        <select id="adj-employee-select" class="w-full px-3 py-2 border border-border rounded-md">
                                            <option value="">Select Employee</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="adjustment-amount" class="block text-sm font-medium mb-1">Adjustment Amount</label>
                                        <input type="number" id="adjustment-amount" step="0.01" class="w-full px-3 py-2 border border-border rounded-md">
                                    </div>
                                    <div>
                                        <label for="adjustment-reason" class="block text-sm font-medium mb-1">Reason</label>
                                        <input type="text" id="adjustment-reason" placeholder="Reason for adjustment" class="w-full px-3 py-2 border border-border rounded-md">
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button type="submit" class="btn-primary">Add Adjustment</button>
                                    <button type="button" id="cancel-adjustment" class="btn-secondary">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>
    
    <!-- New Navigation Script -->
    <script>
        // Navigation function for single-page app
        function switchView(viewName) {
            // Hide all view sections
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected view
            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
                targetView.classList.add('active');
            }
            
            // Initialize specific view functionality
            if (viewName === 'service-history') {
                // Initialize service history to show recent records by default
                setTimeout(() => {
                    // Set default date range to last 30 days
                    const today = new Date();
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(today.getDate() - 30);
                    
                    const startInput = document.getElementById('filter-date-start');
                    const endInput = document.getElementById('filter-date-end');
                    
                    if (startInput && endInput) {
                        startInput.value = thirtyDaysAgo.toISOString().split('T')[0];
                        endInput.value = today.toISOString().split('T')[0];
                        
                        // Trigger the load with default date range
                        if (typeof window.loadServiceHistory === 'function') {
                            window.loadServiceHistory();
                        }
                    }
                }, 100);
            }
            
            if (viewName === 'payroll') {
                // Initialize payroll view - populate employee dropdown
                setTimeout(() => {
                    if (typeof window.populateEmployeeDropdownForAdjustments === 'function') {
                        window.populateEmployeeDropdownForAdjustments();
                    }
                }, 100);
            }
            
            // Update navigation styling
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-primary-foreground');
                item.classList.add('text-muted-foreground', 'hover:bg-secondary');
            });
            
            // Style active nav item
            const activeItem = document.querySelector(`[data-view="${viewName}"]`);
            if (activeItem) {
                activeItem.classList.remove('text-muted-foreground', 'hover:bg-secondary');
                activeItem.classList.add('bg-primary', 'text-primary-foreground');
            }
        }
        
        // Sidebar functionality
        function initializeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const sidebarCloseMobile = document.getElementById('sidebar-close-mobile');
            const mainContent = document.getElementById('main-content');
            
            let sidebarCollapsed = false;
            
            // Desktop sidebar toggle
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebarCollapsed = !sidebarCollapsed;
                    
                    if (sidebarCollapsed) {
                        sidebar.classList.add('sidebar-collapsed');
                        mainContent.classList.add('main-content-expanded');
                        sidebarToggle.innerHTML = '<i data-lucide="panel-right" class="h-5 w-5"></i>';
                        sidebarToggle.title = 'Expand Sidebar';
                    } else {
                        sidebar.classList.remove('sidebar-collapsed');
                        mainContent.classList.remove('main-content-expanded');
                        sidebarToggle.innerHTML = '<i data-lucide="panel-left" class="h-5 w-5"></i>';
                        sidebarToggle.title = 'Collapse Sidebar';
                    }
                    
                    lucide.createIcons();
                    
                    // Store preference
                    localStorage.setItem('sidebarCollapsed', sidebarCollapsed);
                });
            }
            
            // Mobile menu toggle
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.add('sidebar-open');
                    sidebarOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            }
            
            // Close mobile menu
            function closeMobileMenu() {
                sidebar.classList.remove('sidebar-open');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            if (sidebarCloseMobile) {
                sidebarCloseMobile.addEventListener('click', closeMobileMenu);
            }
            
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', closeMobileMenu);
            }
            
            // Close mobile menu when clicking nav items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        closeMobileMenu();
                    }
                });
            });
            
            // Restore saved sidebar state on desktop
            const savedState = localStorage.getItem('sidebarCollapsed');
            if (savedState === 'true' && window.innerWidth > 768) {
                sidebarToggle?.click();
            }
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeMobileMenu();
                } else {
                    // Reset desktop collapsed state on mobile
                    if (sidebarCollapsed) {
                        sidebar.classList.remove('sidebar-collapsed');
                        mainContent.classList.remove('main-content-expanded');
                    }
                }
            });
        }
        
        // Initialize icons and sidebar when page loads
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            initializeSidebar();
        });
    </script>
    
    <!-- Load all JavaScript files for consolidated admin portal -->
    <script src="js/admin-portal.js"></script>
    <script src="js/admin-clients-locations.js"></script>
    <script src="js/admin-employees.js"></script>
    <script src="js/admin-service-history.js"></script>
    <script src="js/admin-payroll.js"></script>
</body>
</html>